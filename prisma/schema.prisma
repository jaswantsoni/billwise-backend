generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id            String         @id @default(auto()) @map("_id") @db.ObjectId
  email         String         @unique
  name          String
  password      String?
  googleId      String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  organisations Organisation[]
}

model Organisation {
  id        String     @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  gstin     String?    @unique
  pan       String?
  address   String
  city      String?
  state     String?
  stateCode String?
  pincode   String?
  phone     String
  email     String
  logo      String?
  bankName  String?
  accountNumber String?
  ifsc      String?
  branch    String?
  upi       String?
  userId    String     @db.ObjectId
  user      User       @relation(fields: [userId], references: [id])
  customers Customer[]
  products  Product[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
}

model Customer {
  id             String    @id @default(auto()) @map("_id") @db.ObjectId
  name           String
  gstin          String?
  email          String?
  phone          String?
  organisationId String    @db.ObjectId
  organisation   Organisation @relation(fields: [organisationId], references: [id])
  addresses      Address[]
  invoices       Invoice[]
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
}

model Address {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  type       String
  line1      String
  line2      String?
  city       String
  state      String
  pincode    String
  country    String   @default("India")
  isDefault  Boolean  @default(false)
  isShipping Boolean  @default(false)
  customerId String   @db.ObjectId
  customer   Customer @relation(fields: [customerId], references: [id])
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Product {
  id             String        @id @default(auto()) @map("_id") @db.ObjectId
  name           String
  description    String?
  sku            String
  hsnCode        String?
  sacCode        String?
  unit           String
  price          Float
  taxRate        Float
  currency       String        @default("INR")
  organisationId String        @db.ObjectId
  organisation   Organisation  @relation(fields: [organisationId], references: [id])
  invoiceItems   InvoiceItem[]
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  @@unique([organisationId, sku])
}

model Invoice {
  id                 String        @id @default(auto()) @map("_id") @db.ObjectId
  invoiceNumber      String        @unique
  customerId         String        @db.ObjectId
  customer           Customer      @relation(fields: [customerId], references: [id])
  billingAddressId   String?       @db.ObjectId
  shippingAddressId  String?       @db.ObjectId
  invoiceDate        DateTime
  dueDate            DateTime
  placeOfSupply      String?
  reverseCharge      Boolean       @default(false)
  invoiceCopyType    String        @default("ORIGINAL")
  subtotal           Float
  cgst               Float         @default(0)
  sgst               Float         @default(0)
  igst               Float         @default(0)
  cess               Float         @default(0)
  roundOff           Float         @default(0)
  totalTax           Float
  total              Float
  amountInWords      String?
  notes              String?
  termsConditions    String?
  declaration        String?
  status             String        @default("DRAFT")
  organisationId     String        @db.ObjectId
  htmlTemplate       String?
  cssTemplate        String?
  items              InvoiceItem[]
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
}

model InvoiceItem {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  invoiceId   String   @db.ObjectId
  invoice     Invoice  @relation(fields: [invoiceId], references: [id])
  productId   String   @db.ObjectId
  product     Product  @relation(fields: [productId], references: [id])
  description String
  hsnSac      String?
  quantity    Float
  unit        String   @default("PCS")
  rate        Float
  discount    Float    @default(0)
  taxRate     Float
  cgst        Float    @default(0)
  sgst        Float    @default(0)
  igst        Float    @default(0)
  amount      Float
  taxAmount   Float
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
